@startuml
!includeurl https://raw.githubusercontent.com/RicardoNiepel/C4-PlantUML/master/C4_Container.puml
scale 0.42
!$ICONURL = "https://raw.githubusercontent.com/tupadr3/plantuml-icon-font-sprites/v3.0.0/icons"
!include $ICONURL/common.puml
!include $ICONURL/devicons2/spring_original.puml
!include $ICONURL/devicons/react.puml
!include $ICONURL/devicons/html5.puml
!include $ICONURL/devicons/postgresql.puml
!include $ICONURL/font-awesome-5/envelope.puml
!include $ICONURL/font-awesome-5/cloud.puml
!include $ICONURL/font-awesome-5/user.puml

AddElementTag("microService-java", $shape=EightSidedShape(), $bgColor="#6DB33F", $fontColor="black", $legendText="Spring Boot Container")
AddElementTag("framework-react", $shape=RoundedBoxShape(), $bgColor="#61DBFB", $fontColor="white", $legendText="React SPA (Vite)")
AddElementTag("storage-postgres", $shape=RoundedBoxShape(), $bgColor="#336791", $borderColor="Black", $fontColor="white", $legendText="PostgreSQL 15")
AddElementTag("webApp", $bgColor="#e34f26", $fontColor="white", $legendText="Web Application (HTML5)")

AddRelTag("purple-line", $lineColor="purple", $legendText="API Calls (REST)")
AddRelTag("blue-line", $lineColor="blue", $legendText="Auth / Sessions")
AddRelTag("green-line", $lineColor="green", $legendText="Documents (S3)")
AddRelTag("orange-line", $lineColor="orange", $legendText="Appointments (domain data)")
AddRelTag("red-line", $lineColor="red", $legendText="Analytics (domain data)")

LAYOUT_TOP_DOWN()
SHOW_PERSON_OUTLINE()


title CourtierPro — C4 Level 2 (Containers)

System_Boundary(cp, "CourtierPro System") {
    Container(frontend_app, "Static Hosting (delivery)", "CloudFront + S3 • HTML5/CSS", "Delivers the static site shell and the React SPA build.", $sprite="html5", $tags="webApp")
    Container(web_spa, "CourtierPro Web App", "React 18 + Vite", "Single SPA with role-based sections (Broker, Client, Admin); i18n en/fr.", $sprite="react", $tags="framework-react")
    Container(backend_api, "CourtierPro Backend API", "Spring Boot 3 (WebFlux)", "REST/JSON over HTTPS; authentication, business logic, file links, notifications.", $sprite="spring_original", $tags="microService-java")
    ContainerDb(main_db, "courtierpro-db", "PostgreSQL 15", "Shared schema; context-owned tables.", $sprite="postgresql", $tags="storage-postgres")
}

together {
Person(broker, "Broker", "Licensed real estate broker in Quebec; manages client files, stages, and appointments.")
Person(client, "Client", "Buyer/Seller; views transaction progress, uploads documents, requests appointments.")
Person(admin, "Admin", "System administration and configuration (users, roles, templates).")
}

together {
System_Ext(auth0, "Auth0", "Identity provider for authentication and OIDC tokens.")
System_Ext(s3, "AWS S3", "Object storage for uploaded documents.")
System_Ext(ses, "AWS SES", "Transactional emails for notifications.")
}

Rel(broker, frontend_app, "Visits", "HTTPS")
Rel(client, frontend_app, "Visits", "HTTPS")
Rel(admin, frontend_app, "Visits", "HTTPS")
Rel_R(frontend_app, web_spa, "Delivers SPA")

Rel(broker, web_spa, "Uses", "HTTPS")
Rel(client, web_spa, "Uses", "HTTPS")
Rel(admin, web_spa, "Uses", "HTTPS")

Rel(web_spa, backend_api, "API calls", "JSON/REST/HTTPS", $tags="purple-line")
Rel(backend_api, main_db, "Reads/Writes", "JDBC/R2DBC")

Rel(backend_api, auth0, "OIDC", "HTTPS", $tags="blue-line")
Rel(web_spa, auth0, "Login redirect", "HTTPS", $tags="blue-line")
Rel(backend_api, s3, "S3 pre-signed ops", "HTTPS", $tags="green-line")
Rel(backend_api, ses, "Transactional email", "HTTPS")

SHOW_LEGEND()
@enduml
